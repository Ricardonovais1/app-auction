
<div class="mx-auto p-4" style="width: 75%; background: #e9ecef">

  <h2 class="mb-5 display-6"><%= Lot.model_name.human %> <%= @lot.code.upcase %></h2> 

  <% if @lot.expired? && @lot.bids.count == 0 %>
    <h3 class="bg-danger text-white" style="--bs-text-opacity: .75; padding: 1rem">Cancelado por falta de lances</h3><br />
  <% elsif @lot.expired? && @lot.bids.count >= 1 %>
    <h3 class="bg-success text-white" style="--bs-text-opacity: .75; padding: 1rem"><strong>Arrematante: </strong><%= @lot.successful_bidder %></h3><br />
  <% end %>

  <p><strong><%= Lot.human_attribute_name(:code) %>:</strong> <%= @lot.code.upcase %> </p>
  <p><strong><%= Lot.human_attribute_name(:start_date) %>:</strong> <%= I18n.l(@lot.start_date) %> </p>
  <p><strong><%= Lot.human_attribute_name(:limit_date) %>:</strong> <%= I18n.l(@lot.limit_date) %> </p>
  <p><strong><%= Lot.human_attribute_name(:minimum_bid_value) %> inicial:</strong> R$<%= @lot.minimum_bid_value %>,00 </p>
  <p><strong><%= Lot.human_attribute_name(:minimum_bid_difference) %>:</strong> R$<%= @lot.minimum_bid_difference %>,00 </p>
  
  <% if !@lot.expired? %>
    <p><strong><%= Lot.human_attribute_name(:minimum_bid_value) %> atual:</strong> R$<%= @lot.bid_value_to_beat %>,00 </p>
  <% end %>

  <% if !@lot.expired? || !@lot.current? %>
    <p><strong>Lances feitos:</strong> <%= @lot.bids.count %></p>
  <% end %>

  <% if @lot.current? || @lot.future? %>
    <p><strong><%= Lot.human_attribute_name(:status) %>:</strong> <%= I18n.t(@lot.status) %></p><br />
  <% end %>

  <% if @lot.future? %>
    <p class="text-primary"><strong>Data de início: <%= I18n.l(@lot.start_date) %> </strong><br />
  <% elsif @lot.expired? %>
    <p class="text-danger"><strong><%= Lot.model_name.human  %> expirado</strong></p><br />
  <% end %>

  <%# <% if !@lot.approved? && !@expired_lots.any? %> 
  <% if !@lot.approved? && @lot.future? %>
    <div>
      <%= link_to 'Adicionar item', new_lot_lot_item_path(lot_id: @lot.id) %>
    </div><br />
  <% end %>
  
  <% if @lot.lot_items.any? %>
    <div class="mb-4">
      <h4 class="mb-2"><strong>Itens do lote:</strong></h4> 

      <% @lot.lot_items.each do |i| %>
        <div class="lot-items d-flex align-items-center gap-3">
          <p class="mt-3"><strong><%= i.item.name %></strong> - cód. <%= i.item.code %></p> 
          <% if !@lot.approved? %>
            <%= button_to 'Remover', remove_lot_lot_item_path(@lot, i), method: :delete, class: "btn btn-light" %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
  
  <span class="align-items-center">
    <% if user_signed_in? && current_user.admin? %>
      <p><strong>Criado por:</strong> <%= @lot.by %> | <%= @lot.by_email %></p>

      <% if current_user.email != @lot.by_email %>

        <% if @lot.pending_approval? && !@lot.expired? %>
          <div class="d-inline-flex ">
            <%= button_to "Aprovar lote", approved_lot_path(@lot.id), class: "btn btn-success mb-3 mt-2 me-2"%>
          </div>
        <% else %>
          <p><strong>Aprovado por:</strong> <%= @lot.approved_by %> | <%= @lot.approved_by_email %></p>
        <% end %>

      <% end %>
    <% end %>
  </span>

  <% if @lot.approved? && @lot.current? %>
    <%= button_to "Fazer um lance a partir de R$#{@lot.bid_value_to_beat},00", new_lot_bid_path(@lot), method: :get, class: "btn btn-primary mb-3 mt-2 me-2" %>
  <% end %>

  <% if !@lot.expired? %>

    <p><i>Tem alguma dúvida? </i></p>

    <%= form_with(model: [@lot, @question]) do |f| %>
      <div>
        <%= f.text_area :body, placeholder: 'Escreva aqui' %>
      </div>
      <div>
        <%= f.submit 'Enviar' %>
      </div>
      
    <% end %>

    <% if @questions.any? %>
      <% @questions.each do |question| %>
        <br />
          <p><i><%= I18n.l(question.created_at, format: '%d de %B de %Y')  %> </i></p>
          <p><strong><%= question.body %></strong></p>
        <br />
      <% end %>
    <% else %>
        <p><i>Nenhuma pergunta</i></p>
    <% end %>
  <% end %>
  <%= link_to 'Tela inicial', root_path, class: "btn btn-success mb-3 mt-2 me-2"  %>

</div>



